/*********************************************************************************************
程序名： 　　 红外线结束程序
编写人： 　　 Jaden
编写时间：　　2018年9月07日
硬件支持：　　STC12C2052AD 12MHz
接口说明：　　  
修改日志：　　
　　NO.1-								
/*********************************************************************************************
说明：

/*********************************************************************************************/
#include<reg52.h>
#define uchar unsigned char
#define uint unsigned int

sbit IRD = P3^2;
uint LOW_number;
uint HIGH_number;

/*********************************************************************************************
函数名：毫秒级CPU延时函数
调  用：DELAY_MS (?);
参  数：1~65535（参数不可为0）
返回值：无
结  果：占用CPU方式延时与参数数值相同的毫秒时间
备  注：应用于1T单片机时i<600，应用于12T单片机时i<125
/*********************************************************************************************/
void DELAY_MS(uint T)
{
	uchar i;
	while(T-- !=0)
	{
		for(i=0;i<600;i++);
	}
}

/*********************************************************************************************

/*********************************************************************************************
函数名  TM0中断初始化
调  用：void init_TM0();
参  数：无
返回值：无
结  果：
备  注：
/*********************************************************************************************/
void init_TM0()
{
	EA=1;
	ET0=1;
	TMOD=0x01;
	TH0=0;
	TL0=0;
	TR0=0;

}
/*********************************************************************************************
/*********************************************************************************************
函数名  检查低电平时间
调  用：uint LOW_Time_Detect();
参  数：无
返回值：无
结  果：
备  注：
/*********************************************************************************************/
uint LOW_Time_Detect()
{
	TH0=0;
	TL0=0;
	TR0=1;
	while(IRD ==0);
	TR0=0;
	LOW_Number= (TH1*255+THO);
	return LOW_Number;
	

	
}
/*********************************************************************************************
函数名  检查低电平时间
调  用：uint HIGHT_Time_Detect();
参  数：无
返回值：无
结  果：
备  注：
/*********************************************************************************************/
uint HIGH_Time_Detect()
{
	TH0=0;
	TL0=0;
	TR0=1;
	while(IRD ==1);
	TR0=0;
	LOW_Number= (TH1*255+THO);
	return HIGHT_Number;
	
}

/*********************************************************************************************
函数名：主函数
调  用：无
参  数：无
返回值：无
结  果：程序开始处，无限循环
备  注：
/**********************************************************************************************/
void main()
{
	int detect_low,detect_high;
	init_TM0();
	while(1)
	{
		if(IRD==0) return;
		detect_low=LOW_Time_Detect();
		if(8000>detect_low>10000) return;

		if(IRD==1) return;
		detect_high=LOW_Time_Detect();
		if(40000>detect_low>50000) return;

		if(IRD==0) return;
		detect_low=LOW_Time_Detect();
		
		
		
	}
}
