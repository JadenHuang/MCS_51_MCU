C51 COMPILER V7.50   MAIN                                                                  09/10/2018 18:04:54 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************************
   2          程序名： 　　 AT24C02储存器读写程序
   3          编写人： 　　 Jaden
   4          编写时间：　　2018年9月10日
   5          硬件支持：　　STC12C2052AD 12MHz
   6          接口说明：　　  
   7          修改日志：　　
   8          　　NO.1-                                                               
   9          /*********************************************************************************************
  10          说明：
  11          
  12          /*********************************************************************************************/
  13          #include<reg51.h>
  14          
  15          #define uchar unsigned char
  16          #define uint unsigned int
  17          
  18          sbit I2C_SDA = P2^0;
  19          sbit I2C_SCL = P2^1;
  20          
  21          sbit KEY_1 = P1^0;
  22          
  23          
  24          uchar Dat_Number;
  25          uchar Current_Number;
  26          uchar Number;
  27          
  28          /*********************************************************************************************
  29          函数名：毫秒级CPU延时函数
  30          调  用：DELAY_MS (?);
  31          参  数：1~65535（参数不可为0）
  32          返回值：无
  33          结  果：占用CPU方式延时与参数数值相同的毫秒时间
  34          备  注：应用于1T单片机时i<600，应用于12T单片机时i<125
  35          /*********************************************************************************************/
  36          void DELAY_MS(uint T)
  37          {
  38   1              uint i;
  39   1              while(T-- !=0)
  40   1              {
  41   2                      for(i=0;i<600;i++);
  42   2              }
  43   1      }
  44          
  45          /*********************************************************************************************
  46          函数名：微秒级CPU延时函数
  47          调  用：DELAY_US (?);
  48          参  数：1~65535（参数不可为0）
  49          返回值：无
  50          结  果：占用CPU方式延时与参数数值相同的毫秒时间
  51          备  注:
  52          /*********************************************************************************************/
  53          void DELAY_US(uchar T)
  54          {
  55   1              while(T-- !=0);
C51 COMPILER V7.50   MAIN                                                                  09/10/2018 18:04:54 PAGE 2   

  56   1      }
  57          
  58          /*********************************************************************************************
  59          函数名：I2C开启函数
  60          调  用：I2C_start();
  61          参  数：
  62          返回值：无
  63          结  果：
  64          备  注：
  65          /*********************************************************************************************/
  66          void I2C_start()
  67          {
  68   1              I2C_SDA =1;
  69   1              DELAY_US(4);
  70   1              I2C_SCL =1;
  71   1              DELAY_US(4);
  72   1              I2C_SDA =0;
  73   1              DELAY_US(4);
  74   1      }
  75          
  76          /*********************************************************************************************
  77          函数名：I2C关闭函数
  78          调  用：I2C_stop();
  79          参  数：
  80          返回值：无
  81          结  果：
  82          备  注：
  83          /*********************************************************************************************/
  84          void I2C_stop()
  85          {
  86   1              I2C_SDA =0;
  87   1              DELAY_US(4);
  88   1              I2C_SCL =1;
  89   1              DELAY_US(4);
  90   1              I2C_SDA =1;
  91   1              DELAY_US(4);
  92   1      }
  93          
  94          /*********************************************************************************************
  95          函数名：I2C发送数据
  96          调  用：I2C_send_byte(uchar dat);
  97          参  数：
  98          返回值：
  99          结  果：
 100          备  注：
 101          /*********************************************************************************************/
 102          void I2C_send_dat(uchar dat)
 103          {
 104   1              uchar i,j;
 105   1              I2C_SCL =0;
 106   1              for(i=0;i<8;i++)
 107   1              {
 108   2      
 109   2                      I2C_SDA =(bit)(dat & 0x80);
 110   2                      dat=dat<<1;
 111   2                      I2C_SCL =1;
 112   2                      DELAY_US(12);
 113   2                      I2C_SCL=0;
 114   2                      DELAY_US(4);
 115   2              }
 116   1              I2C_SDA=1;
 117   1              DELAY_US(4);
C51 COMPILER V7.50   MAIN                                                                  09/10/2018 18:04:54 PAGE 3   

 118   1              I2C_SCL=1;
 119   1              DELAY_US(4);
 120   1              j = 0;
 121   1              while(I2C_SDA==1 && j<200) j++;
 122   1              DELAY_US(4);
 123   1              I2C_SCL=0;
 124   1              DELAY_US(4);
 125   1      }
 126          
 127          /*********************************************************************************************
 128          函数名：I2C读数据
 129          调  用：uchar I2C_read_dat(void);
 130          参  数：
 131          返回值：无
 132          结  果：
 133          备  注：
 134          /*********************************************************************************************/
 135          uchar I2C_read_dat(void)
 136          {
 137   1              uchar i,rdat;
 138   1              rdat=0x00;
 139   1              I2C_SDA=1;
 140   1              for(i=0;i<8;i++)
 141   1              {
 142   2                      I2C_SCL=0;              
 143   2                      rdat=rdat<<1;
 144   2                      DELAY_US(4);
 145   2                      I2C_SCL=1;
 146   2                      DELAY_US(4);
 147   2                      if(I2C_SDA==1)
 148   2                      {
 149   3                              rdat = rdat|0x01;
 150   3                      }
 151   2                      I2C_SCL=0;
 152   2                      DELAY_US(4);
 153   2              }
 154   1              return rdat;
 155   1      }
 156          
 157          /*********************************************************************************************
 158          函数名：发送应答位:1标示发送应答，0标示不发送应答；
 159          调  用：I2C_send_ask(uchar A)
 160          参  数：
 161          返回值：无
 162          结  果：
 163          备  注：
 164          /*********************************************************************************************/
 165          void I2C_send_ask(uchar A)
 166          {
 167   1              if(A==0)
 168   1              {
 169   2                      I2C_SDA=1;
 170   2                      DELAY_US(4);
 171   2                      I2C_SCL=1;
 172   2                      DELAY_US(12);
 173   2                      I2C_SCL=0;
 174   2                      DELAY_US(4);
 175   2              }else
 176   1              {
 177   2      
 178   2                      I2C_SDA=0;
 179   2                      DELAY_US(4);
C51 COMPILER V7.50   MAIN                                                                  09/10/2018 18:04:54 PAGE 4   

 180   2                      I2C_SCL=1;
 181   2                      DELAY_US(12);
 182   2                      I2C_SCL=0;
 183   2                      DELAY_US(4);
 184   2              }
 185   1      
 186   1              
 187   1      }
 188          
 189          /*********************************************************************************************
 190          函数名：写数据到EEPROM内
 191          调  用：AT24C02_write_Byte(uchar Address,uchar dat);
 192          参  数：
 193          返回值：无
 194          结  果：
 195          备  注：
 196          /*********************************************************************************************/
 197          void AT24C02_write_Byte(uchar Address,uchar dat)
 198          {
 199   1              I2C_start();
 200   1              I2C_send_dat(0xa0);
 201   1              I2C_send_dat(Address);
 202   1              I2C_send_dat(dat);
 203   1              I2C_stop();
 204   1      }
 205          /*********************************************************************************************
 206          函数名：从EEPROM内读数据
 207          调  用：uchar AT24C02_read_Byte(uchar Address);
 208          参  数：
 209          返回值：无
 210          结  果：
 211          备  注：
 212          /*********************************************************************************************/
 213          uchar AT24C02_read_Byte(uchar Address)
 214          {
 215   1              I2C_start();
 216   1              I2C_send_dat(0xa1);
 217   1              I2C_send_dat(Address);
 218   1      
 219   1              I2C_start();
 220   1              I2C_send_dat(0xa0);
 221   1              Dat_Number=I2C_read_dat();
 222   1              I2C_send_ask(0);
 223   1              I2C_stop();
 224   1              
 225   1              return Dat_Number;
 226   1      }
 227          
 228          /*********************************************************************************************
 229          函数名：按键扫描函数
 230          调  用：void keyscane()
 231          参  数：
 232          返回值：无
 233          结  果：
 234          备  注：
 235          /*********************************************************************************************/
 236          void keyscane()
 237          {
 238   1              if(KEY_1==0)
 239   1              {
 240   2                      DELAY_MS(20);
 241   2                      if(KEY_1==0)
C51 COMPILER V7.50   MAIN                                                                  09/10/2018 18:04:54 PAGE 5   

 242   2                      {
 243   3                              Number=0x0a;
 244   3                              DELAY_MS(50);
 245   3                      }
 246   2              }
 247   1      }
 248          
 249          /*********************************************************************************************
 250          函数名：main()
 251          调  用：
 252          参  数：
 253          返回值：
 254          结  果：
 255          备  注：
 256          /*********************************************************************************************/
 257          void main()
 258          {
 259   1              Number = 0x00;
 260   1              Current_Number = AT24C02_read_Byte(0x01);
 261   1              while(1)
 262   1              {
 263   2                      keyscane();
 264   2                      if(Number == 0x0a)
 265   2                      {
 266   3                              AT24C02_write_Byte(0x02,0xaa);
 267   3                      }       
 268   2                      P0=Current_Number;
 269   2              }
 270   1      
 271   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    312    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
